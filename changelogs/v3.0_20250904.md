# v3.0 版本更新日誌
發布日期：2025-09-04

## 主要更新

### 網站詳細頁面報表生成功能
在網站詳細頁面（WebsiteDetail）新增了完整的報表生成功能，讓用戶可以直接從網站詳細資訊頁面下載該網站的監控報表。

### 新增功能
1. **報表下載按鈕組**
   - PDF 報表下載按鈕
   - CSV 數據匯出按鈕
   - 按鈕組與時間範圍選擇器整合
   - 下載進度指示器

2. **PDF 報表功能**
   - 包含網站基本資訊
   - 統計摘要（可用性、回應時間等）
   - 最近監控數據表格
   - 自動生成檔案名稱（包含網站名稱、時間範圍、時間戳）

3. **CSV 數據匯出**
   - 完整監控數據匯出
   - Excel 相容格式
   - UTF-8 BOM 支援中文顯示
   - 包含所有監控指標

### 技術實作

1. **後端改進**
   - 新增 `/backend/src/routes/websiteReports.js` 專門處理單一網站報表
   - 使用現有 API 獲取數據，無需直接連線 InfluxDB
   - 簡化架構，提高穩定性

2. **前端整合**
   - 在 `/frontend/src/services/api.js` 新增 `reportsApi` 服務
   - 在 `WebsiteDetail.js` 新增報表下載功能
   - 整合 Material-UI 按鈕組件

3. **API 端點**
   - `GET /api/reports/:websiteId/pdf` - 生成 PDF 報表
   - `GET /api/reports/:websiteId/csv` - 生成 CSV 數據
   - `GET /api/reports/:websiteId/preview` - 預覽報表數據

### 問題修復
- 修復後端服務因報表模組初始化失敗導致無法啟動的問題
- 移除對 InfluxDB 環境變數的直接依賴
- 改善錯誤處理機制

### 檔案變更
- 新增：`/backend/src/routes/websiteReports.js`
- 修改：`/backend/src/app.js`
- 修改：`/frontend/src/services/api.js`
- 修改：`/frontend/src/pages/WebsiteDetail.js`
- 更新：功能表.md
- 更新：.env 環境變數

## 使用說明
1. 進入任何網站的詳細頁面
2. 在頁面右上方可看到「PDF 報表」和「CSV 數據」按鈕
3. 選擇時間範圍（1小時至90天）
4. 點擊相應按鈕即可下載報表

## 注意事項
- PDF 報表使用 PDFKit 生成，檔案較小且生成快速
- CSV 檔案包含 UTF-8 BOM，確保 Excel 正確顯示中文
- 報表檔案名稱自動包含網站名稱、時間範圍和時間戳

## 下一步計劃
- 增加報表樣式美化
- 支援批量網站報表生成
- 增加報表排程功能
- 支援更多報表格式（如 Excel）