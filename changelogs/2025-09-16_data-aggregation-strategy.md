# 實作不同時間範圍的資料聚合策略

## 發布日期
2025-09-16 17:59

## 版本
v1.0.3-patch

## 修復內容

### 問題描述
- 當選擇較長時間範圍（如 7 天、30 天）時，回傳資料點過多
- 圖表顯示密集，影響效能和視覺效果
- 需要根據不同時間範圍調整資料採樣策略

### 解決方案
更新 InfluxService 加入智能資料聚合功能：

#### 聚合策略
- **1小時**：顯示每分鐘原始資料（無聚合）
- **3小時**：每 2 分鐘聚合一次
- **6小時**：每 5 分鐘聚合一次
- **12小時**：每 10 分鐘聚合一次
- **24小時**：每 15 分鐘聚合一次
- **2天**：每 30 分鐘聚合一次
- **7天**：每 1 小時聚合一次
- **14天**：每 2 小時聚合一次
- **30天**：每 4 小時聚合一次
- **90天**：每 12 小時聚合一次

## 技術細節

### 修改檔案
- `backend/src/services/InfluxService.js`
  - 新增 `getAggregationWindow()` 方法
  - 更新 `getMetrics()` 方法支援條件式聚合
  - 使用 InfluxDB 的 `aggregateWindow` 函數

### 聚合方法
- 數值型欄位（回應時間、連線時間等）：使用平均值 (mean)
- 狀態碼、SSL 過期天數：使用最後值 (last)
- 健康狀態：使用最小值 (min) 以保守估計

## 測試結果
- ✅ 1小時資料：10 筆（原始資料）
- ✅ 3小時資料：33 筆（已聚合）
- ✅ 7天資料：1929 筆（從可能 2000+ 筆減少）
- ✅ 30天資料：3437 筆（從可能 8600+ 筆減少）

## 效能改善
- 減少前端渲染負擔
- 降低網路傳輸資料量
- 提升圖表顯示流暢度
- 保持資料準確性的同時優化視覺呈現

## 影響範圍
- 不影響原始資料儲存
- 只在查詢時進行聚合
- 保留足夠的資料精度用於分析