# 修復 PDF 報表動態標題與圖表

## 發布日期
2025-09-17 10:50

## 版本
v1.0.9-patch

## 修復內容

### 問題描述
- PDF 報表中「24小時響應時間趨勢」標題硬編碼，不隨時間範圍變化
- 圖表 X 軸刻度固定為 24 小時格式，不適應其他時間範圍
- 網格線數量固定，不根據時間範圍調整

### 解決方案

#### 1. 動態標題
將硬編碼的標題改為動態生成：
```javascript
// 原本：'24小時響應時間趨勢'
// 改為：`${timeRangeText}響應時間趨勢`
```

#### 2. 動態圖表網格
新增輔助函數 `getTimeSteps()` 根據時間範圍返回適當的時間段數：
- 1小時：6個段（每10分鐘）
- 7天：7個段（每天）
- 30天：6個段（每5天）

#### 3. 動態 X 軸標籤
新增 `getTimeRangeHours()` 函數計算總小時數，並根據時間範圍調整標籤格式：
- ≤24小時：顯示 HH:00 格式
- >24小時：顯示 MM/DD 格式

## 技術細節

### 修改檔案
- `backend/src/routes/websiteReports.js`
  - 第 333 行：動態生成標題
  - 第 603 行：使用 getTimeSteps() 動態計算網格
  - 第 746-764 行：根據時間範圍調整 X 軸標籤
  - 第 793-825 行：新增輔助函數

### 新增函數
```javascript
getTimeSteps(timeRange) // 返回時間段數
getTimeRangeHours(timeRange) // 返回總小時數
```

## 測試結果
- ✅ 1小時報表：顯示「過去1小時響應時間趨勢」
- ✅ 7天報表：顯示「過去7天響應時間趨勢」
- ✅ 30天報表：顯示「過去30天響應時間趨勢」
- ✅ 圖表 X 軸標籤根據時間範圍正確顯示
- ✅ 網格線數量隨時間範圍動態調整

## 影響範圍
- PDF 報表的標題動態顯示
- 圖表視覺效果更適合不同時間範圍
- 提升報表的專業性和準確性