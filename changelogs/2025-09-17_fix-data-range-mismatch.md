# 修復資料範圍不足造成的失真問題

## 發布日期
2025-09-17 13:39

## 版本
v1.0.16-patch

## 修復內容

### 問題描述
- 系統 9/1 上線，實際只有約 7-17 天資料
- 選擇「最近 30 天」時，會顯示不存在的日期（8/18 - 8/31）
- SLA 計算基於錯誤的時間範圍，導致數據失真
- PDF 報表 X 軸顯示錯誤的日期標籤

### 解決方案

#### 1. 後端 API 返回實際資料範圍
修改 `backend/src/routes/metrics.js`：
- 計算實際資料的起始和結束時間
- 在統計資料中加入 `actualDataRange` 欄位
- 包含實際天數、起始日期、結束日期

```javascript
actualDataRange: {
  startDate: "2025-09-10",
  endDate: "2025-09-17",
  days: 8,
  hours: 192
}
```

#### 2. PDF 報表顯示實際範圍
修改 `backend/src/routes/websiteReports.js`：
- 檢查實際資料天數是否少於請求天數
- 顯示「09/10 - 09/17 (實際 8 天)」而非「最近 30 天」
- X 軸使用實際資料時間，而非回推計算

#### 3. 前端界面提示
修改 `frontend/src/pages/WebsiteDetail.js`：
- 在統計摘要右上角顯示實際資料範圍
- 使用醒目的琥珀色背景標示
- 格式：「實際資料: 2025-09-10 ~ 2025-09-17 (8天)」

## 技術細節

### 修改檔案
1. `backend/src/routes/metrics.js`
   - 第 384-396 行：計算實際資料時間範圍
   - 第 413-418 行：返回 actualDataRange 資訊

2. `backend/src/routes/websiteReports.js`
   - 第 199-210 行：PDF 顯示實際資料範圍
   - 第 748-793 行：X 軸使用實際資料時間

3. `frontend/src/pages/WebsiteDetail.js`
   - 第 575-580 行：顯示實際資料範圍提示

## 測試結果
- ✅ PDF 報表正確顯示實際日期範圍
- ✅ 前端界面顯示資料不足提醒
- ✅ X 軸不再顯示不存在的日期
- ✅ SLA 計算基於實際監控天數

## 影響範圍
- 提升資料準確性，避免誤導
- 使用者清楚了解實際監控範圍
- 統計數據更真實可信

## 使用者體驗改進
- 透明顯示實際資料範圍
- 避免「最近 30 天」的誤解
- 確保報表數據的真實性