server {
    listen 80;
    server_name _;

    # 健康檢查/快速確認
    location = /healthz {
        add_header Content-Type text/plain;
        return 200 'ok';
    }

    location / {
        # 轉發到 frontend 容器的 3000
        proxy_pass         http://frontend:3000;

        # 轉發時的標頭（保留客戶端資訊＆避免 Websocket 問題）
        proxy_set_header   Host $host;
        proxy_set_header   X-Real-IP $remote_addr;
        proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header   X-Forwarded-Proto $scheme;
        proxy_http_version 1.1;
        proxy_set_header   Upgrade $http_upgrade;
        proxy_set_header   Connection "upgrade";

        # 時間與緩衝可視需要調整
        proxy_connect_timeout   30s;
        proxy_read_timeout      300s;
        proxy_send_timeout      300s;
    }

    # API 路由 - 返回503錯誤提示後端未啟動
    location /api/ {
        return 503 "Backend API service is not running in frontend-only mode";
        add_header Content-Type text/plain;
    }

    # Grafana 路由 - 返回503錯誤提示Grafana未啟動
    location /grafana/ {
        return 503 "Grafana service is not running in frontend-only mode";
        add_header Content-Type text/plain;
    }
}